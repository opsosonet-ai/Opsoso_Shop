<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${pageTitle}">Thống kê Hàng hóa</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .data-table {
            font-size: 0.85rem;
        }
        
        .data-table thead th {
            font-size: 0.9rem;
            padding: 0.75rem;
            background-color: #0d6efd;
            color: white;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .data-table tbody td {
            font-size: 0.85rem;
            padding: 0.6rem 0.75rem;
            vertical-align: middle;
        }
        
        .table-container {
            max-height: calc(100vh - 250px);
            overflow-y: auto;
        }
        
        .summary-card {
            border-left: 4px solid #0d6efd;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="/dashboard">
                <i class="fas fa-chart-line me-2"></i>OSS
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/dashboard">
                            <i class="fas fa-tachometer-alt me-1"></i>Tổng quan
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/nhan-vien">
                            <i class="fas fa-users me-1"></i>Nhân viên
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/hang-hoa">
                            <i class="fas fa-box me-1"></i>Hàng hóa
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/khach-hang">
                            <i class="fas fa-user-friends me-1"></i>Khách hàng
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/nha-phan-phoi">
                            <i class="fas fa-truck me-1"></i>Nhà phân phối
                        </a>
                    </li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/settings">
                            <i class="fas fa-cog me-1"></i>Cài đặt
                        </a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user me-1"></i>Người dùng
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="/auth/change-password">
                                <i class="fas fa-key me-2"></i>Đổi mật khẩu
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="/auth/logout">
                                <i class="fas fa-sign-out-alt me-2"></i>Đăng xuất
                            </a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid mt-4" style="padding-bottom: 80px;">
        <!-- Page Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1><i class="fas fa-chart-bar me-3"></i><span th:text="${pageTitle}">Thống kê Hàng hóa</span></h1>
            <div class="btn-group">
                <a href="/hang-hoa" class="btn btn-secondary">
                    <i class="fas fa-arrow-left me-2"></i>Quay lại
                </a>
                <a href="/hang-hoa/thong-ke/today" class="btn btn-outline-success">
                    <i class="fas fa-calendar-day me-2"></i>Hôm nay
                </a>
                <a th:if="${isYearRange}" href="/hang-hoa/thong-ke/30days" class="btn btn-outline-primary">
                    <i class="fas fa-calendar me-2"></i>30 Ngày Gần Nhất
                </a>
                <a th:if="${!isYearRange}" href="/hang-hoa/thong-ke" class="btn btn-outline-primary">
                    <i class="fas fa-calendar-year me-2"></i>Năm Hiện Tại
                </a>
            </div>
        </div>
        <div class="mb-4 text-muted small" th:if="${thirtyDayStart != null && thirtyDayEnd != null && daysLimit > 1}">
            Dữ liệu hiển thị trong <span th:text="${daysLimit}">30</span> ngày gần nhất
            (từ <span th:text="${#temporals.format(thirtyDayStart, 'dd/MM/yyyy')}">dd/MM/yyyy</span>
            đến <span th:text="${#temporals.format(thirtyDayEnd, 'dd/MM/yyyy')}">dd/MM/yyyy</span>).
        </div>
        <div class="mb-4 text-muted small" th:if="${thirtyDayStart != null && thirtyDayEnd != null && daysLimit == 1}">
            <i class="fas fa-calendar-day me-2"></i>
            Đang hiển thị dữ liệu trong ngày hôm nay (<span th:text="${#temporals.format(thirtyDayStart, 'dd/MM/yyyy')}">dd/MM/yyyy</span>) 
            từ 00:00 đến 23:59.
        </div>
        <div class="mb-4 text-muted small" th:if="${isYearRange}">
            <i class="fas fa-calendar-year me-2"></i>
            Đang hiển thị dữ liệu toàn bộ năm <span th:text="${currentYear}">2025</span>
            (từ <span th:text="${#temporals.format(yearStart, 'dd/MM/yyyy')}">01/01/2025</span>
            đến <span th:text="${#temporals.format(yearEnd, 'dd/MM/yyyy')}">31/12/2025</span>).
        </div>
        <div class="mb-4 text-muted small" th:if="${isFullRange}">
            Đang hiển thị toàn bộ dữ liệu nhập và bán hàng có trong hệ thống.
        </div>

        <!-- Thông báo về doanh thu -->
        <div class="alert alert-info" role="alert">
            <i class="fas fa-info-circle me-2"></i>
            <strong>Thông tin doanh thu:</strong> Doanh thu thực tế đã trừ đi các giao dịch trả hàng đã được duyệt. 
            Khi từ chối trả hàng sau khi đã duyệt, số tiền sẽ được tính lại vào doanh thu.
        </div>

        <!-- Summary Cards -->
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="card summary-card">
                    <div class="card-body">
                        <h5 class="card-title text-muted">Tổng số lượng bán</h5>
                        <h2 class="mb-0" id="totalQuantity">0</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card summary-card">
                    <div class="card-body">
                        <h5 class="card-title text-muted">Doanh thu gộp</h5>
                        <h2 class="mb-0" th:text="${#format.vnd(doanhThuGop)}">0 VNĐ</h2>
                        <small class="text-muted">Từ bán hàng</small>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card summary-card">
                    <div class="card-body">
                        <h5 class="card-title text-muted">Tiền trả hàng</h5>
                        <h2 class="mb-0 text-danger" th:text="${#format.vnd(tongTienTraHang)}">0 VNĐ</h2>
                        <small class="text-muted">Đã duyệt trả</small>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-md-4">
                <div class="card summary-card">
                    <div class="card-body">
                        <h5 class="card-title text-muted">Tổng số lượng nhập</h5>
                        <h2 class="mb-0" id="totalImportQuantity">0</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card summary-card">
                    <div class="card-body">
                        <h5 class="card-title text-success">Doanh thu thực tế</h5>
                        <h2 class="mb-0 text-success" th:text="${#format.vnd(doanhThuThucTe)}">0 VNĐ</h2>
                        <small class="text-muted">Đã trừ trả hàng</small>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card summary-card">
                    <div class="card-body">
                        <h5 class="card-title text-muted">Số giao dịch</h5>
                        <h2 class="mb-0" id="totalTransactions">0</h2>
                        <small class="text-muted">Phiếu xuất</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Table -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-list me-2"></i>Chi tiết Hàng hóa đã bán</h5>
            </div>
            <div class="card-body p-0">
                <div class="px-3 py-3 border-bottom bg-light-subtle">
                    <div class="row g-3 align-items-end">
                        <div class="col-md-6 col-lg-4">
                            <label for="saleSearchInput" class="form-label mb-1">Tìm kiếm nhanh</label>
                            <input type="text" id="saleSearchInput" class="form-control form-control-sm" placeholder="Nhập từ khóa...">
                        </div>
                        <div class="col-md-6 col-lg-4">
                            <label for="saleInvoiceFilter" class="form-label mb-1">Mã phiếu xuất</label>
                            <div class="input-group">
                                <select id="saleInvoiceFilter" class="form-select form-select-sm">
                                    <option value="">Tất cả mã phiếu</option>
                                    <option th:each="maPhieu : ${maPhieuXuatList}"
                                            th:value="${maPhieu}"
                                            th:text="${maPhieu}">PX001</option>
                                </select>
                                <button type="button" class="btn btn-outline-primary btn-sm" id="btnPrintSelectedPhieu" 
                                        onclick="printSelectedPhieuXuat()" 
                                        title="In phiếu xuất được chọn" disabled>
                                    <i class="fas fa-print"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="table-container">
                    <table class="table table-striped table-hover mb-0 data-table" id="statsTable">
                        <thead>
                            <tr>
                                <th>STT</th>
                                <th>Mã phiếu</th>
                                <th>Tên hàng hóa</th>
                                <th>Số Serial</th>
                                <th>Số lượng</th>
                                <th>Đơn giá</th>
                                <th>Thành tiền</th>
                                <th>Khách hàng</th>
                                <th>Ngày bán</th>
                                <th>Ghi chú</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:if="${#lists.isEmpty(danhSachBanHang)}">
                                <td colspan="10" class="text-center text-muted py-4">
                                    <i class="fas fa-inbox fa-2x mb-2"></i>
                                    <p class="mb-0">Chưa có dữ liệu bán hàng</p>
                                </td>
                            </tr>
                            <tr th:each="item, iterStat : ${danhSachBanHang}" class="sale-row"
                                th:attr="data-invoice-code=${item.phieuXuat != null and item.phieuXuat.maPhieuXuat != null ? item.phieuXuat.maPhieuXuat : ''}">
                                <td th:text="${iterStat.count}">1</td>
                                <td th:text="${item.phieuXuat.maPhieuXuat}">PX001</td>
                                <td th:text="${item.hangHoa.tenHangHoa}">Laptop Dell XPS 15</td>
                                <td th:text="${item.hangHoa.soSerial}">SN123456</td>
                                <td th:text="${item.soLuong}">1</td>
                                <td th:text="${#numbers.formatDecimal(item.donGia, 0, 'COMMA', 0, 'POINT')} + ' đ'">25,000,000 đ</td>
                                <td th:text="${#numbers.formatDecimal(item.thanhTien, 0, 'COMMA', 0, 'POINT')} + ' đ'">25,000,000 đ</td>
                                <td th:text="${item.phieuXuat.khachHang != null and item.phieuXuat.khachHang.hoTen != null ? item.phieuXuat.khachHang.hoTen : 'Khách lẻ'}">Nguyễn Văn A</td>
                                <td th:text="${#temporals.format(item.phieuXuat.ngayXuat, 'dd/MM/yyyy HH:mm')}">27/10/2025 10:30</td>
                                <td th:text="${item.ghiChu != null ? item.ghiChu : '-'}">-</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="card-footer d-flex justify-content-between align-items-center flex-wrap gap-2">
                <span class="small text-muted" id="salePageInfo">Hiển thị 0-0 / 0</span>
                <div class="btn-group">
                    <button type="button" class="btn btn-outline-primary btn-sm" id="salePrevBtn" disabled>Trước</button>
                    <button type="button" class="btn btn-outline-primary btn-sm" id="saleNextBtn" disabled>Tiếp theo</button>
                </div>
            </div>
        </div>

        <!-- Import Table -->
        <div class="card mt-4">
            <div class="card-header">
                <div class="row">
                    <div class="col-md-6">
                        <h5 class="mb-0"><i class="fas fa-warehouse me-2"></i>Chi tiết Hàng hóa đã nhập</h5>
                    </div>
                    <div class="col-md-6 text-end">
                        <input type="text" id="importSearchInput" class="form-control form-control-sm d-inline-block w-auto"
                               placeholder="Tìm kiếm...">
                    </div>
                </div>
            </div>
            <div class="card-body p-0">
                <div class="table-container">
                    <table class="table table-striped table-hover mb-0 data-table" id="importTable">
                        <thead>
                            <tr>
                                <th>STT</th>
                                <th>Tên hàng hóa</th>
                                <th>Mã hàng</th>
                                <th>Số Serial</th>
                                <th>Số lượng nhập</th>
                                <th>Giá trị nhập</th>
                                <th>Nhà cung cấp</th>
                                <th>Ngày nhập</th>
                                <th>Ghi chú</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:if="${#lists.isEmpty(danhSachNhapHang)}">
                                <td colspan="9" class="text-center text-muted py-4">
                                    <i class="fas fa-inbox fa-2x mb-2"></i>
                                    <p class="mb-0">Chưa có dữ liệu nhập hàng</p>
                                </td>
                            </tr>
                            <tr th:each="hang, iterStat : ${danhSachNhapHang}"
                                class="import-row">
                                <td th:text="${iterStat.count}">1</td>
                                <td th:text="${hang.tenHangHoa}">Laptop Dell XPS 13</td>
                                <td th:text="${hang.maHangHoa}">LAP001</td>
                                <td th:text="${hang.soSerial}">SN2024001</td>
                                <td th:text="${hang.soLuongTon != null ? hang.soLuongTon : 0}">10</td>
                                <td th:text="${hang.tongGiaTriNhap != null ? #numbers.formatDecimal(hang.tongGiaTriNhap, 0, 'COMMA', 0, 'POINT') + ' đ' : '-'}">200,000,000 đ</td>
                                <td th:text="${hang.thuongHieu != null ? hang.thuongHieu : '-'}">Dell</td>
                                <td th:text="${hang.ngayNhap != null ? #temporals.format(hang.ngayNhap, 'dd/MM/yyyy') : '-'}">05/01/2024</td>
                                <td th:text="${hang.moTa != null ? hang.moTa : '-'}">Ghi chú</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="card-footer d-flex justify-content-between align-items-center flex-wrap gap-2">
                <span class="small text-muted" id="importPageInfo">Hiển thị 0-0 / 0</span>
                <div class="btn-group">
                    <button type="button" class="btn btn-outline-primary btn-sm" id="importPrevBtn" disabled>Trước</button>
                    <button type="button" class="btn btn-outline-primary btn-sm" id="importNextBtn" disabled>Tiếp theo</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script th:inline="javascript">
        document.addEventListener('DOMContentLoaded', function() {
            // Tổng kết bán hàng
            const saleRows = Array.from(document.querySelectorAll('.sale-row'));
            let totalQuantity = 0;
            
            saleRows.forEach(row => {
                const cells = row.querySelectorAll('td');
                const quantityText = (cells[4]?.textContent || '0').replace(/[^\d]/g, '');
                const quantity = parseInt(quantityText, 10) || 0;
                totalQuantity += quantity;
            });
            
            const totalTransactions = saleRows.length;
            const totalQuantityEl = document.getElementById('totalQuantity');
            if (totalQuantityEl) totalQuantityEl.textContent = totalQuantity.toLocaleString('vi-VN');
            const totalTransactionsEl = document.getElementById('totalTransactions');
            if (totalTransactionsEl) totalTransactionsEl.textContent = totalTransactions.toLocaleString('vi-VN');
            
            const SALE_ROWS_PER_PAGE = 10;
            let saleCurrentPage = 1;
            const salePrevBtn = document.getElementById('salePrevBtn');
            const saleNextBtn = document.getElementById('saleNextBtn');
            const salePageInfo = document.getElementById('salePageInfo');
            const saleInvoiceFilter = document.getElementById('saleInvoiceFilter');
            saleRows.forEach(row => {
                row.dataset.matchesSearch = 'true';
                row.dataset.matchesInvoice = 'true';
            });

            const updateSalePagination = (page = saleCurrentPage) => {
                const matchingRows = saleRows.filter(row => row.dataset.matchesSearch !== 'false' && row.dataset.matchesInvoice !== 'false');
                const totalRows = matchingRows.length;
                const totalPages = totalRows === 0 ? 1 : Math.ceil(totalRows / SALE_ROWS_PER_PAGE);
                saleCurrentPage = totalRows === 0 ? 1 : Math.min(Math.max(page, 1), totalPages);
                const startIndex = (saleCurrentPage - 1) * SALE_ROWS_PER_PAGE;
                const endIndex = startIndex + SALE_ROWS_PER_PAGE;
                saleRows.forEach(row => {
                    row.style.display = 'none';
                });

                matchingRows.forEach((row, index) => {
                    row.style.display = (index >= startIndex && index < endIndex) ? '' : 'none';
                });

                if (salePageInfo) {
                    if (totalRows === 0) {
                        salePageInfo.textContent = 'Không có dữ liệu';
                    } else {
                        const startItem = startIndex + 1;
                        const endItem = Math.min(endIndex, totalRows);
                        salePageInfo.textContent = `Hiển thị ${startItem}-${endItem} / ${totalRows}`;
                    }
                }

                if (salePrevBtn) {
                    salePrevBtn.disabled = totalRows === 0 || saleCurrentPage <= 1;
                }
                if (saleNextBtn) {
                    saleNextBtn.disabled = totalRows === 0 || saleCurrentPage >= totalPages;
                }
            };

            const saleSearchInput = document.getElementById('saleSearchInput');
            if (saleSearchInput) {
                saleSearchInput.addEventListener('keyup', function() {
                    const searchText = this.value.toLowerCase();
                    saleRows.forEach(row => {
                        const matches = row.textContent.toLowerCase().includes(searchText);
                        row.dataset.matchesSearch = matches ? 'true' : 'false';
                    });
                    updateSalePagination(1);
                });
            }

            if (saleInvoiceFilter) {
                saleInvoiceFilter.addEventListener('change', function() {
                    const selectedCode = this.value;
                    saleRows.forEach(row => {
                        const invoiceCode = row.dataset.invoiceCode || '';
                        const matches = !selectedCode || selectedCode === invoiceCode;
                        row.dataset.matchesInvoice = matches ? 'true' : 'false';
                    });
                    updateSalePagination(1);
                    
                    // Bật/tắt nút in phiếu xuất
                    const btnPrintSelectedPhieu = document.getElementById('btnPrintSelectedPhieu');
                    if (btnPrintSelectedPhieu) {
                        btnPrintSelectedPhieu.disabled = !selectedCode || selectedCode === '';
                    }
                });
            }

            if (salePrevBtn) {
                salePrevBtn.addEventListener('click', () => updateSalePagination(saleCurrentPage - 1));
            }
            if (saleNextBtn) {
                saleNextBtn.addEventListener('click', () => updateSalePagination(saleCurrentPage + 1));
            }

            updateSalePagination(1);
            
            // Tổng kết nhập hàng
            const importRows = document.querySelectorAll('.import-row');
            let totalImportQuantity = 0;
            let totalImportValue = 0;
            
            importRows.forEach(row => {
                const cells = row.querySelectorAll('td');
                const quantityText = (cells[4]?.textContent || '0').replace(/[^\d]/g, '');
                const valueText = (cells[5]?.textContent || '0').replace(/[^\d]/g, '');
                const quantity = parseInt(quantityText, 10) || 0;
                const value = parseFloat(valueText) || 0;
                totalImportQuantity += quantity;
                totalImportValue += value;
            });
            
            const totalImportQuantityEl = document.getElementById('totalImportQuantity');
            if (totalImportQuantityEl) totalImportQuantityEl.textContent = totalImportQuantity.toLocaleString('vi-VN');
            const totalImportValueEl = document.getElementById('totalImportValue');
            if (totalImportValueEl) totalImportValueEl.textContent = totalImportValue.toLocaleString('vi-VN') + ' đ';
            const totalImportItemsEl = document.getElementById('totalImportItems');
            if (totalImportItemsEl) totalImportItemsEl.textContent = importRows.length.toLocaleString('vi-VN');
            
            const IMPORT_ROWS_PER_PAGE = 10;
            let importCurrentPage = 1;
            const importPrevBtn = document.getElementById('importPrevBtn');
            const importNextBtn = document.getElementById('importNextBtn');
            const importPageInfo = document.getElementById('importPageInfo');
            importRows.forEach(row => row.dataset.matchesSearch = 'true');

            const updateImportPagination = (page = importCurrentPage) => {
                const matchingRows = Array.from(importRows).filter(row => row.dataset.matchesSearch !== 'false');
                const totalRows = matchingRows.length;
                const totalPages = totalRows === 0 ? 1 : Math.ceil(totalRows / IMPORT_ROWS_PER_PAGE);
                importCurrentPage = totalRows === 0 ? 1 : Math.min(Math.max(page, 1), totalPages);
                const startIndex = (importCurrentPage - 1) * IMPORT_ROWS_PER_PAGE;
                const endIndex = startIndex + IMPORT_ROWS_PER_PAGE;

                importRows.forEach(row => {
                    if (row.dataset.matchesSearch === 'false') {
                        row.style.display = 'none';
                    }
                });

                matchingRows.forEach((row, index) => {
                    row.style.display = (index >= startIndex && index < endIndex) ? '' : 'none';
                });

                if (importPageInfo) {
                    if (totalRows === 0) {
                        importPageInfo.textContent = 'Không có dữ liệu';
                    } else {
                        const startItem = startIndex + 1;
                        const endItem = Math.min(endIndex, totalRows);
                        importPageInfo.textContent = `Hiển thị ${startItem}-${endItem} / ${totalRows}`;
                    }
                }

                if (importPrevBtn) {
                    importPrevBtn.disabled = totalRows === 0 || importCurrentPage <= 1;
                }
                if (importNextBtn) {
                    importNextBtn.disabled = totalRows === 0 || importCurrentPage >= totalPages;
                }
            };

            const importSearchInput = document.getElementById('importSearchInput');
            if (importSearchInput) {
                importSearchInput.addEventListener('keyup', function() {
                    const searchText = this.value.toLowerCase();
                    importRows.forEach(row => {
                        const matches = row.textContent.toLowerCase().includes(searchText);
                        row.dataset.matchesSearch = matches ? 'true' : 'false';
                    });
                    updateImportPagination(1);
                });
            }

            if (importPrevBtn) {
                importPrevBtn.addEventListener('click', () => updateImportPagination(importCurrentPage - 1));
            }
            if (importNextBtn) {
                importNextBtn.addEventListener('click', () => updateImportPagination(importCurrentPage + 1));
            }

            updateImportPagination(1);
        });
        
        // Hàm in phiếu xuất được chọn
        function printSelectedPhieuXuat() {
            const saleInvoiceFilter = document.getElementById('saleInvoiceFilter');
            if (!saleInvoiceFilter) {
                alert('Không tìm thấy dropdown mã phiếu xuất!');
                return;
            }
            
            const selectedMaPhieu = saleInvoiceFilter.value;
            if (!selectedMaPhieu || selectedMaPhieu === '') {
                alert('Vui lòng chọn mã phiếu xuất cần in!');
                return;
            }
            
            // Mở trang in phiếu xuất trong tab mới
            const printUrl = `/phieu-xuat/print-by-ma/${encodeURIComponent(selectedMaPhieu)}`;
            window.open(printUrl, '_blank', 'width=800,height=600,scrollbars=yes,resizable=yes');
        }
    </script>
</body>
</html>

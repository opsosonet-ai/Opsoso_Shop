# Server Configuration
server.address=0.0.0.0
server.port=8080

# MariaDB Database Configuration
spring.datasource.url=jdbc:mariadb://localhost:3306/oss?useUnicode=true&characterEncoding=utf8&useSSL=false&allowPublicKeyRetrieval=true
spring.datasource.driver-class-name=org.mariadb.jdbc.Driver
spring.datasource.username=root
spring.datasource.password=JavaBean@

# Connection Pool Configuration - OPTIMIZED
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.connection-timeout=20000
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=1200000
spring.datasource.hikari.initialization-fail-timeout=-1
spring.datasource.hikari.connection-test-query=SELECT 1
spring.datasource.hikari.auto-commit=true
spring.datasource.hikari.leak-detection-threshold=60000

# Prepared statement caching for better performance
spring.datasource.hikari.data-source-properties.cachePrepStmts=true
spring.datasource.hikari.data-source-properties.prepStmtCacheSize=250
spring.datasource.hikari.data-source-properties.prepStmtCacheSqlLimit=2048
spring.datasource.hikari.data-source-properties.useServerPrepStmts=true
spring.datasource.hikari.data-source-properties.useLocalSessionState=true

# JPA Configuration
spring.jpa.database-platform=org.hibernate.dialect.MariaDBDialect
spring.jpa.hibernate.ddl-auto=none
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.use_sql_comments=true

# ✅ PERFORMANCE: Hibernate Optimization
spring.jpa.properties.hibernate.jdbc.fetch_size=50
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true
spring.jpa.open-in-view=false

# Allow app to start even if database is not available
spring.sql.init.continue-on-error=true

# Enable schema and data initialization
spring.jpa.defer-datasource-initialization=false
spring.sql.init.mode=never
spring.sql.init.data-locations=classpath:data.sql

# Prevent app from hanging on database connection failures
spring.jpa.properties.hibernate.boot.allow_jdbc_metadata_access=false
spring.h2.console.enabled=false

# Lazy initialize repositories to avoid early validation
spring.jpa.properties.hibernate.generate_statistics=false

# Redis Configuration for Caching
spring.data.redis.host=localhost
spring.data.redis.port=6379
spring.data.redis.password=
spring.data.redis.timeout=60000ms
spring.data.redis.jedis.pool.max-active=20
spring.data.redis.jedis.pool.max-idle=10
spring.data.redis.jedis.pool.min-idle=5
spring.data.redis.jedis.pool.max-wait=-1ms

# Cache Configuration
# ⚠️ DISABLED: Redis not running - using default (no-op) cache
spring.cache.type=simple
# spring.cache.redis.time-to-live=600000
# spring.cache.redis.cache-null-values=false

# Disable Spring Data Redis repositories to avoid auto-detection conflicts with JPA
spring.data.redis.repositories.enabled=false

# ✅ PERFORMANCE: HTTP Compression
server.compression.enabled=true
server.compression.min-response-size=1024
server.compression.mime-types=application/json,application/xml,text/html,text/xml,text/plain,text/css,application/javascript

# ✅ PERFORMANCE: Tomcat Tuning
server.tomcat.threads.max=200
server.tomcat.threads.min-spare=10
server.tomcat.accept-count=100
server.tomcat.max-connections=10000
server.tomcat.max-http-form-post-size=10485760

# Logging Configuration
# Suppress HandlerMappingIntrospector cache miss warnings (normal on first request)
logging.level.org.springframework.web.servlet.handler.HandlerMappingIntrospector=ERROR
# Suppress UserDetailsService auto-configuration warning (we're using custom AuthenticationProvider)
logging.level.org.springframework.security.config.annotation.authentication.configuration.InitializeUserDetailsBeanManagerConfigurer=ERROR
# Suppress Hibernate dialect warning (MariaDBDialect is intentionally specified for early initialization)
logging.level.org.hibernate.orm.deprecation=ERROR
# Suppress Hibernate JTA platform info message (JTA is not needed for JDBC transactions)
logging.level.org.hibernate.engine.transaction.jta.platform.internal.JtaPlatformInitiator=WARN
# Suppress Hibernate PersistenceUnitInfo processing info message (verbose but not essential)
logging.level.org.hibernate.jpa.internal.util.LogHelper=WARN
# Keep Spring Security at INFO level for important messages
logging.level.org.springframework.security=INFO
# Keep application logs at INFO level
logging.level.com.example.demo=INFO